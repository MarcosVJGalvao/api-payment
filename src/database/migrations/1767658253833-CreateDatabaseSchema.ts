import { MigrationInterface, QueryRunner } from "typeorm";

export class CreateDatabaseSchema1767658253833 implements MigrationInterface {
    name = 'CreateDatabaseSchema1767658253833'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`CREATE TABLE \`permission\` (\`id\` varchar(36) NOT NULL, \`name\` varchar(255) NOT NULL COMMENT 'Nome da permissão (ex: user:read)', \`module\` varchar(100) NOT NULL COMMENT 'Módulo da permissão (ex: user, employee)', \`action\` varchar(50) NOT NULL COMMENT 'Ação da permissão (ex: read, write, create)', \`description\` text NULL COMMENT 'Descrição da permissão', \`created_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \`updated_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), \`deleted_at\` datetime(6) NULL, INDEX \`IDX_6aab65e9a6d63e7b0efdb5f0c2\` (\`module\`, \`action\`), UNIQUE INDEX \`IDX_240853a0c3353c25fb12434ad3\` (\`name\`), PRIMARY KEY (\`id\`)) ENGINE=InnoDB`);
        await queryRunner.query(`CREATE TABLE \`role_permission\` (\`id\` varchar(36) NOT NULL, \`created_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \`updated_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), \`deleted_at\` datetime(6) NULL, \`role_id\` varchar(36) NULL, \`permission_id\` varchar(36) NULL, INDEX \`IDX_e3a3ba47b7ca00fd23be4ebd6c\` (\`permission_id\`), INDEX \`IDX_3d0a7155eafd75ddba5a701336\` (\`role_id\`), UNIQUE INDEX \`IDX_f7c47ad384a95ad0c454b52990\` (\`role_id\`, \`permission_id\`, \`deleted_at\`), PRIMARY KEY (\`id\`)) ENGINE=InnoDB`);
        await queryRunner.query(`CREATE TABLE \`role\` (\`id\` varchar(36) NOT NULL, \`name\` varchar(255) NOT NULL COMMENT 'Nome da role', \`description\` text NULL COMMENT 'Descrição da role', \`created_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \`updated_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), \`deleted_at\` datetime(6) NULL, UNIQUE INDEX \`IDX_ae4578dcaed5adff96595e6166\` (\`name\`), PRIMARY KEY (\`id\`)) ENGINE=InnoDB`);
        await queryRunner.query(`CREATE TABLE \`audit_log\` (\`id\` varchar(36) NOT NULL, \`action\` enum ('USER_CREATED', 'USER_UPDATED', 'USER_DELETED', 'USER_STATUS_CHANGED', 'USER_PASSWORD_CHANGED', 'USER_VIEWED', 'USER_LOGIN', 'USER_LOGOUT', 'USER_LOGIN_FAILED', 'PERMISSION_GRANTED', 'PERMISSION_REVOKED', 'ROLE_ASSIGNED', 'ROLE_REMOVED', 'EMPLOYEE_CREATED', 'EMPLOYEE_UPDATED', 'EMPLOYEE_DELETED', 'GUARDIAN_CREATED', 'GUARDIAN_UPDATED', 'GUARDIAN_DELETED', 'GUARDIAN_VIEWED', 'STUDENT_CREATED', 'STUDENT_UPDATED', 'STUDENT_DELETED', 'STUDENT_VIEWED', 'STUDENT_STATUS_CHANGED', 'SCHOOL_YEAR_CREATED', 'SCHOOL_YEAR_UPDATED', 'SCHOOL_YEAR_DELETED', 'SCHOOL_YEAR_VIEWED', 'CLASS_CREATED', 'CLASS_UPDATED', 'CLASS_DELETED', 'CLASS_VIEWED', 'TEACHER_CREATED', 'TEACHER_UPDATED', 'TEACHER_DELETED', 'TEACHER_VIEWED', 'SUBJECT_CREATED', 'SUBJECT_UPDATED', 'SUBJECT_DELETED', 'SUBJECT_VIEWED', 'ENROLLMENT_CREATED', 'ENROLLMENT_UPDATED', 'ENROLLMENT_DELETED', 'ENROLLMENT_VIEWED', 'SCHOOL_CONFIG_CREATED', 'SCHOOL_CONFIG_UPDATED', 'SCHOOL_CONFIG_DELETED', 'GRADE_CREATED', 'GRADE_UPDATED', 'GRADE_DELETED', 'GRADE_BATCH_CREATED', 'ATTENDANCE_CREATED', 'ATTENDANCE_UPDATED', 'ATTENDANCE_DELETED', 'ATTENDANCE_BATCH_CREATED', 'CLASS_NOTE_CREATED', 'CLASS_NOTE_UPDATED', 'CLASS_NOTE_DELETED', 'CLASS_SCHEDULE_CREATED', 'CLASS_SCHEDULE_UPDATED', 'CLASS_SCHEDULE_DELETED', 'SCHOOL_CALENDAR_EVENT_CREATED', 'SCHOOL_CALENDAR_EVENT_UPDATED', 'SCHOOL_CALENDAR_EVENT_DELETED', 'SCHOOL_CALENDAR_EVENT_VIEWED', 'INVOICE_CREATED', 'INVOICE_UPDATED', 'INVOICE_CANCELLED', 'INVOICE_REMINDER_SENT', 'PAYMENT_RECORDED', 'PAYMENT_CONFIRMED', 'PAYMENT_CANCELLED', 'DISCOUNT_APPLIED', 'DISCOUNT_REMOVED', 'SCHOLARSHIP_CREATED', 'SCHOLARSHIP_UPDATED', 'SCHOLARSHIP_CANCELLED', 'WEBHOOK_CONFIG_CREATED', 'WEBHOOK_CONFIG_UPDATED', 'WEBHOOK_CONFIG_DELETED', 'BANK_STATEMENT_IMPORTED', 'BANK_TRANSACTION_RECONCILED', 'FINANCIAL_CONFIG_CREATED', 'FINANCIAL_CONFIG_UPDATED', 'FINANCIAL_CONFIG_DELETED', 'FINANCIAL_PRODUCT_CREATED', 'FINANCIAL_PRODUCT_UPDATED', 'FINANCIAL_PRODUCT_DELETED', 'PAYMENT_METHOD_CREATED', 'PAYMENT_METHOD_UPDATED', 'PAYMENT_METHOD_DELETED', 'PAYMENT_PLAN_CREATED', 'PAYMENT_PLAN_UPDATED', 'PAYMENT_PLAN_DELETED', 'FINANCIAL_CATEGORY_CREATED', 'FINANCIAL_CATEGORY_UPDATED', 'FINANCIAL_CATEGORY_DELETED', 'COST_CENTER_CREATED', 'COST_CENTER_UPDATED', 'COST_CENTER_DELETED', 'BANK_ACCOUNT_CREATED', 'BANK_ACCOUNT_UPDATED', 'BANK_ACCOUNT_DELETED', 'BANK_ACCOUNT_BALANCE_UPDATED', 'CURRENCY_CREATED', 'CURRENCY_UPDATED', 'CURRENCY_DELETED', 'CURRENCY_EXCHANGE_RATE_UPDATED', 'DOCUMENT_UPLOADED', 'DOCUMENT_UPDATED', 'DOCUMENT_DELETED', 'CONTRACT_IMPORTED', 'CONTRACT_EXPORTED') NOT NULL COMMENT 'Ação realizada', \`entity_type\` varchar(100) NOT NULL COMMENT 'Tipo da entidade (ex: User, Employee)', \`entity_id\` varchar(36) NULL COMMENT 'ID da entidade afetada', \`user_id\` varchar(36) NULL COMMENT 'ID do usuário que realizou a ação', \`username\` varchar(255) NULL COMMENT 'Nome de usuário que realizou a ação', \`correlation_id\` varchar(36) NULL COMMENT 'ID de correlação da requisição', \`old_values\` json NULL COMMENT 'Valores anteriores da entidade', \`new_values\` json NULL COMMENT 'Valores novos da entidade', \`ip_address\` varchar(45) NULL COMMENT 'Endereço IP do cliente', \`user_agent\` text NULL COMMENT 'User agent do cliente', \`description\` text NULL COMMENT 'Descrição adicional da ação', \`status\` enum ('Success', 'Failure') NOT NULL COMMENT 'Status da operação' DEFAULT 'Success', \`error_message\` text NULL COMMENT 'Mensagem de erro, se a operação falhou', \`error_code\` varchar(100) NULL COMMENT 'Código do erro, se a operação falhou', \`created_at\` datetime(6) NOT NULL COMMENT 'Data e hora da criação do log' DEFAULT CURRENT_TIMESTAMP(6), INDEX \`IDX_279c2f0ef471f2ddbdea4790e6\` (\`status\`), INDEX \`IDX_be1cc5ca1752801131dd5321f2\` (\`correlation_id\`), INDEX \`IDX_2ad7930a7c2af80585c8c1b770\` (\`created_at\`), INDEX \`IDX_951e6339a77994dfbad976b35c\` (\`action\`), INDEX \`IDX_cb11bd5b662431ea0ac455a27d\` (\`user_id\`), INDEX \`IDX_43fef0ec7f613c19c612fffe62\` (\`entity_type\`, \`entity_id\`), PRIMARY KEY (\`id\`)) ENGINE=InnoDB`);
        await queryRunner.query(`ALTER TABLE \`role_permission\` ADD CONSTRAINT \`FK_3d0a7155eafd75ddba5a7013368\` FOREIGN KEY (\`role_id\`) REFERENCES \`role\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`role_permission\` ADD CONSTRAINT \`FK_e3a3ba47b7ca00fd23be4ebd6cf\` FOREIGN KEY (\`permission_id\`) REFERENCES \`permission\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`ALTER TABLE \`role_permission\` DROP FOREIGN KEY \`FK_e3a3ba47b7ca00fd23be4ebd6cf\``);
        await queryRunner.query(`ALTER TABLE \`role_permission\` DROP FOREIGN KEY \`FK_3d0a7155eafd75ddba5a7013368\``);
        await queryRunner.query(`DROP INDEX \`IDX_43fef0ec7f613c19c612fffe62\` ON \`audit_log\``);
        await queryRunner.query(`DROP INDEX \`IDX_cb11bd5b662431ea0ac455a27d\` ON \`audit_log\``);
        await queryRunner.query(`DROP INDEX \`IDX_951e6339a77994dfbad976b35c\` ON \`audit_log\``);
        await queryRunner.query(`DROP INDEX \`IDX_2ad7930a7c2af80585c8c1b770\` ON \`audit_log\``);
        await queryRunner.query(`DROP INDEX \`IDX_be1cc5ca1752801131dd5321f2\` ON \`audit_log\``);
        await queryRunner.query(`DROP INDEX \`IDX_279c2f0ef471f2ddbdea4790e6\` ON \`audit_log\``);
        await queryRunner.query(`DROP TABLE \`audit_log\``);
        await queryRunner.query(`DROP INDEX \`IDX_ae4578dcaed5adff96595e6166\` ON \`role\``);
        await queryRunner.query(`DROP TABLE \`role\``);
        await queryRunner.query(`DROP INDEX \`IDX_f7c47ad384a95ad0c454b52990\` ON \`role_permission\``);
        await queryRunner.query(`DROP INDEX \`IDX_3d0a7155eafd75ddba5a701336\` ON \`role_permission\``);
        await queryRunner.query(`DROP INDEX \`IDX_e3a3ba47b7ca00fd23be4ebd6c\` ON \`role_permission\``);
        await queryRunner.query(`DROP TABLE \`role_permission\``);
        await queryRunner.query(`DROP INDEX \`IDX_240853a0c3353c25fb12434ad3\` ON \`permission\``);
        await queryRunner.query(`DROP INDEX \`IDX_6aab65e9a6d63e7b0efdb5f0c2\` ON \`permission\``);
        await queryRunner.query(`DROP TABLE \`permission\``);
    }

}
